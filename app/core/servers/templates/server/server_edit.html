{% extends "base.html" %}
{% block content %}
    {% from "forms/macros.html" import render_field %}

      <form class="form" method="post">
        {{ form.csrf_token }}
        <h2 class="form">{{ _('Edit server') }}</h2>
        {{ render_field(form.name, class="input-xlarge") }}
        {{ render_field(form.address, class="input-xlarge") }}
        {{ render_field(form.login, class="input-xlarge") }}
        {{ render_field(form.password, class="input-xlarge") }}
        {{ render_field(form.protocol) }}
        {% if g.user.role == 300 %}
            {{ render_field(form.organisations, class="input-xlarge") }}
        {% endif %}
        {{ render_field(form.users, class="input-xlarge") }}
        {{ render_field(form.submit, class="btn btn-primary") }}
      </form>


{% if g.user.role == 300 %}
<script type=text/javascript>

    function _update_options_users() {
        var id = $('[name="organisations"] option:selected').val()
        var items = [];
        $.getJSON('/organisation/accounts/' + id, function(data) {
            $.each( data.accounts, function( key, val ) {
                    if (val.selected)
                        items.push('<option value="' + val.id + '" selected="selected">' + val.displayname + '</option>');
                    else
                        items.push('<option value="' + val.id + '">' + val.displayname + '</option>');
                })
            $('[name="users"]').html(items);
            })
    }

    $('[name="organisations"]').ready(function() {
        _update_options_users();
    });

    $('[name="organisations"]').change(function() {
        _update_options_users();
    });

</script>
{% endif %}

{% endblock %}

